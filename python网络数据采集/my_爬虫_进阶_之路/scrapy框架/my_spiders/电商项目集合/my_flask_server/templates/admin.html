<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>管理员列表</title>
		<link rel="stylesheet" type="text/css" href="../static/css/reset.css"/>
		<link rel="stylesheet" type="text/css" href="../static/css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="../static/css/animate.min.css"/>
	</head>
	<style type="text/css">
			html,
			body {
			  width: 100%;
			  font-size: .16rem;
			  color: #333333;
			}
			html {
			  font-size: 100px;
			} 
			.main{
				width: 12rem;
				height: auto;
				margin: 0 auto;
			}  		
			.header{
				width: 100%;
				height: 1.14rem;
			}
			.title{
				width: 100%;
				height: .56rem;
				line-height: .56rem;
				background: #cae3fb;
			}
			.title>div{
				float: left;
				text-indent: .2rem;
			}
			.title .add{
				float: right;
				width: 1.2rem;
				background: url(../static/images/add1.png)no-repeat 0% 50%;
				text-indent: .6rem;
				color: #2581c9;
				cursor: pointer;
				font-size: .2rem;
			}
			.seach{
				width: 100%;
				height: .58rem;
				line-height: .58rem;
			}
			.seach-content{
				display: inline-block;
				width: 2.9rem;
				height: .32rem;
			}
			.seach-content input{
				width: 100%;
				height: 100%;
				border: 1px solid #ebebeb;
				border-radius: 8px;
				text-indent: .3rem;
				outline: none;
			}
			.seach-content input:focus{
				border-color: #2581c9;
			}
			.seach-btn{
				display: inline-block;
			}
			.seach-btn a{
				display: inline-block;
				color: #2581c9;
			}
			.getlist{
				margin-left: .4rem;
			}
			.t-header{
				width: 100%;
				height: .6rem;
				color: #FFFFFF;
				
			}
			.table-striped>tbody>tr:nth-child(odd):first-child{
				background-color: #3a8fdc;
			}
			table tr,table th{
				text-align: center;
				height: .46rem;
			}
			.resetPass{
				display: inline-block;
				margin-right: .2rem;
			}
			.box{
				display: inline-block;
				width: .2rem;
				height: .2rem;
				vertical-align: bottom;
			}
			.allDelete{
				display: inline-block;
				width: .8rem;
				height: .3rem;
				line-height: .3rem;
				background: #FFFFFF;
				border-radius: .08rem;
				text-decoration: none!important;
			}
 	.adduser{
 		display: none;
 		position: fixed;
 		left: 0;
 		top: 0;
 		right: 0;
 		bottom: 0;
 		margin: auto;
 		background: rgba(0,0,0,.4);
 	}
 	.login-content{
    width: 5rem;
    height: 4rem;
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    margin: auto;
    background: #FFFFFF;
    padding-top: .4rem;
    border-radius: 5px;
 	}
 	.login-content>div{
 		height: .28rem;
 		line-height: .28rem;
 		margin-bottom: .2rem;
 	}
 	.phone,.setPass,.confirmPass,.command,.ralenane,.department{
 		display: block;
 		width: 3.0rem;
 		height: .28rem;
 		border: .01rem solid #CCCCCC;
 		border-radius: .05rem;
 		margin: 0 auto;
 		text-indent: 5px;
 	}
 	.login-btn{
 		width: 3.0rem;
 		height:  .4rem; 		
 		margin: 0 auto;
 	}
 	.login-btn input{
 		width: 3.0rem;
 		height:  .4rem; 
 		background: #439aeb;
 		color: #ffffff;
 		text-align: center;
 		line-height: .4rem;
 		border-radius: .05rem;

 	}
 	.wPhone,.wPass{
 		text-align: center;
 		color: red;
 	}			
	</style>
	<body>
		<div class="main">
			<div class="header">
				<div class="title">
					<div>客服管理</div>
					<div class="add">添加</div>
				</div>
				<div class="seach">
					<div class="seach-content">
						<input type="text" name="seachName" id="seachName" value=""placeholder="请输入您要查找的用户名或手机号" />
					</div>
					<div class="seach-btn"><a class="find" href="javascript:;">查找</a><a class="getlist" href="javascript:;">点击查看当前所有客服信息</a></div>
				</div>
			</div>
			<div class="login content">
				<table class="table table-striped table-bordered table-hover" border="" cellspacing="" cellpadding="">
					<tr class="t-header">
						<th>真实姓名</th>
						<th>手机号</th>
						<th>密码</th>
						<th>部门</th>
						<th>创建时间</th>
						<th>管理 <a class="allDelete" href="javascript:;">批量删除</a></th>
					</tr>
				</table>
			</div>
		</div>
		<div class="adduser">
			<form class="login-content" action="" method="post">
				<div><input type="text" name="ralenane" class="ralenane" id="ralenane" value="" placeholder="真实姓名"/></div>
				<div><input type="text" name="department" class="department" id="department" value="" placeholder="部门"/></div>
				<div><input type="text" name="username" class="phone" id="phone" value="" placeholder="手机号"/><div class="wPhone"></div></div>
				<div><input type="password" name="passwd" class="setPass"  id="setPass" value="" placeholder="设置密码" /><div class=""></div></div>
				<div><input type="password" name="" class="confirmPass"  id="confirmPass" value="" placeholder="确认密码" /><div class="wPass"></div></div>
				<!--<div><input type="text" name="inner_pass" class="command"  id="command" value="" placeholder="内部员工口令" /></div>								-->
				<div class="login-btn"><input id="regBtn" type="submit" value="注册"/></div>
			</form>
		</div>
		<script src="../static/js/jquery-2.0.0.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../static/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../static/js/ejs.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/template" id="temp" charset="utf-8">
			<tbody>
			<tr class="t-header">
				<th>真实姓名</th>
				<th>手机号</th>
				<th>密码</th>
				<th>部门</th>
				<th>创建时间</th>
				<th>管理 <a class="allDelete" href="javascript:;">批量删除</a></th>
			</tr>
			<% for(var i=0;i<data.length;i++){%>
			<tr class="userList">
				<td>
					<input type="checkbox" name="name" class="box" value=""/><%=data[i].realnane%>
				</td>
				<td name='username'><%=data[i].username%></td>
				<td><%=data[i].passwd%></td>
				<td><%=data[i].department%></td>
				<td><%=data[i].createtime%></td>
				<td>
					<a href="javascript:;" class="resetPass">reset</a><a class="delete" href="javascript:;">delete</a>
				</td>
			</tr>
			<% } %>
			</tbody>
		</script>
		<script type="text/javascript">
					/*REM*/
		~function(){
			var desW = 1920,
				winW = document.documentElement.clientWidth||document.body.clientWidth;
				document.documentElement.style.fontSize = winW / desW * 100 + 'px';
		}();   
		//bindhtml
		$(function () {

            function bind(data) {
                console.log(data);
                var $tmp = $('#temp').html();
                var $tar = $('.table');
                $tar.html(ejs.render($tmp, {data: data}));
                 //重置密码
            $('.resetPass').click(function () {
                var updateTar = $(this).parent().siblings().eq(1).html();
                $.ajax({
                    type: 'post',
                    url: '/admin',
                    async: true,
                    data: {
                        update: updateTar
                    },
                    success: function (data) {
                        data = JSON.parse(data);
                        bind(data.data)
                    }
                })
            })
            //批量删除
            $('.allDelete').click(function () {
                var deleteArr = new Array();
                var waitArr = new Array();
                for (var i = 0; i < $('.box').length; i++) {
                    if (($('.box').eq(i).is(":checked"))) {
                        deleteArr.push($('.box').eq(i).parent().siblings().eq(0).html());
                        waitArr.push(i);
                    }
                }
                $.ajax({
                    type: 'post',
                    url: '/admin',
                    async: true,
                    data: {
                        user_to_delete_list: deleteArr
                    },
                    success: function (data) {
                        data = JSON.parse(data);
                        if (data.reason == 'success') {
                            alert('删除成功');
                            for (var j = 0; j < waitArr.length; j++) {
                                $('.userList').eq(waitArr[j]).addClass(' fadeOutLeft animated').hide(200);
                            }
                        } else {
                            alert('删除失败')
                        }
                    },
                    error: function () {
                        alert('删除失败')
                    }
                })
            })
            //删除用户
            $('.delete').click(function () {

                _this = this;
                var deleteTar = $(this).parent().siblings().eq(1).html();
                var arr = new Array();
                arr[0] = deleteTar;
                console.log(arr);
                $.ajax({
                    type: 'post',
                    url: '/admin',
                    async: true,
                    data: {
                        user_to_delete_list: arr
                    },
                    success: function (data) {
                        data = JSON.parse(data);
                        if (data.reason == 'success') {
                            alert('删除成功')
                            $(_this).parents('tr').addClass(' fadeOutLeft animated').hide(500);
                        } else {
                            alert('删除失败')

                        }
                    },
                    error: function () {
                        alert('删除失败')
                    }
                });


            })
            }

            //获取所有员工数据
            $('.getlist').click(function () {
                $.ajax({
                    type: "post",
                    url: "/admin",
                    async: true,
                    data: {
                        check_all_users: 'True'
                    },
                    success: function (data) {
                        data = JSON.parse(data);
                        bind(data.data)
                    }
                });
            });
            //查找员工数据
            $('.find').click(function () {
                var findTar = $('#seachName').val();
                $.ajax({
                    type: 'post',
                    url: '/admin',
                    async: true,
                    data: {
                        find_name: findTar
                    },
                    success: function (data) {
                        data = JSON.parse(data);
                        bind(data.data)
                    }
                })
            })
            //添加
            $('.add').click(function(){
            	$('.adduser').show();
            })
//判断用户输入信息是否符合
		var isTrue = false;
		$('#phone').keyup(function(){
			var curInput = $('#phone').val(),
					Reg  = /^((\d3)|(\d{3}\-))?[13|15|18][0-9]\d{8}|15[89]\d{8}$/;
					if(!Reg.test(curInput)||curInput.length!='11'){
						$('.wPhone').text('您的输入的手机号码不合格');
						isTrue = false;
					}else{
						$('.wPhone').text('');
						isTrue = true;
					}			
		})
		$('#confirmPass').keyup(function(){
			var curInput = $('#confirmPass').val(),
					curPass = $('#setPass').val();
					
					if(curInput != curPass){
						$('.wPass').text('两次密码必须一致');
						isTrue = false;
					}else{
						$('.wPass').text('')
						isTrue = true;
					}			
		})		
//判断用户信息是否完成然后提交
		$('.login-btn').click(function(){
			if($('#phone').val()==''||$('#setPass').val()== ''||$('#comfirmPass').val()== ''||$('#command').val()==''||$('.ralenane').val()==''||$('.department').val()==''){
				console.log('1')
				return false
			}else{
				console.log('2')
				return
			}
		})
        })
		
		</script>
	</body>
</html>
